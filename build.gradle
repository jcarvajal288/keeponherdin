task testBackend(type:Exec) {
    workingDir './backend'
    commandLine 'lein', 'test'
}

task testFrontend(type:Exec) {
    workingDir './frontend'
    commandLine 'yarn', 'test-run'
}

task testAll {
    dependsOn tasks.testBackend
    dependsOn tasks.testFrontend
}

task buildBackendUberJar(type:Exec) {
    dependsOn tasks.testBackend
    workingDir './backend'
    commandLine 'lein', 'do', 'clean,', 'ring', 'uberjar'
}

task buildFrontend(type:Exec) {
    dependsOn tasks.testFrontend
    workingDir './frontend'
    commandLine 'yarn', 'build'
}

task buildBackendContainer(type:Exec) {
    dependsOn tasks.buildBackendUberJar
    workingDir './backend'
    commandLine 'docker', 'build', '-t', 'keeponherdin-backend', '.'
}

task buildFrontendContainer(type:Exec) {
    dependsOn tasks.buildFrontend
    workingDir './frontend'
    commandLine 'docker', 'build', '-t', 'keeponherdin-frontend', '.'
}

task buildAllContainers {
    dependsOn tasks.buildBackendContainer
    dependsOn tasks.buildFrontendContainer
}
